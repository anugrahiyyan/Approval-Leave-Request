<!DOCTYPE html>
<html>

<head>
  <!--
    Creator: Galbatorix
    Created for ONEderland Leave Request System
    If you need support, improvements, or bug fixes, please contact the creator.

    Version: 16
    Date: September 13, 2025
  -->
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
      padding: 1rem;
    }

    .result-card {
      width: 100%;
      max-width: 600px;
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
    }

    .card-title {
      font-size: 1.75rem;
    }

    .alert {
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
    }
  </style>
</head>

<body>
  <div class="result-card card shadow-sm">
    <div class="card-body">
      <!-- Title -->
      <h2 class="card-title mb-3">
        <? const isAutoRejected = (action === 'reject' && note && note.includes('Auto-rejected,')); ?>
        <? if (isAutoRejected) { ?>
        <span class="text-warning">⚠️ System Override → Auto-Rejected</span>
        <? } else if (action === 'approve') { ?>
        <span class="text-success">✅ Request Approved</span>
        <? } else if (action === 'reject') { ?>
        <span class="text-danger">❌ Request Rejected</span>
        <? } else { ?>
        <span class="text-info">ℹ️ Request Has Been Processed</span>
        <? } ?>
      </h2>

      <!-- Note Area -->
      <? const alertClass = isAutoRejected ? 'warning' : (action === 'approve' ? 'success' : (action === 'reject' ? 'danger' : 'info')); ?>
      <div class="alert alert-<?= alertClass ?>">
        <h5 class="alert-heading">
          <?= isAutoRejected ? `Auto-Rejection (System Override) at ${stage}` : `Decision ${stage} Stage` ?>
        </h5>
        <p class="mb-0">
          <? if (note && note.trim() !== "") { ?>
          Note:
          <?!= note ?>
          <? } else if (action === 'reject') { ?>
          No specific note was provided for this rejection.
          <? } else { ?>
          The action was processed.
          <? } ?>
        </p>
      </div>

      <!-- Special Explanation for Auto-Rejection -->
      <? if (isAutoRejected) { ?>
      <div class="alert alert-info">
        <strong>What now?</strong>
        <p class="mt-2 mb-0">
          The approver attempted to approve this request, but the system automatically <strong>rejected</strong> it due
          to insufficient leave balance.
          <br>
          The requester must <strong>re-confirm with you</strong> as <em>
            <?= stage ?>
          </em> and re-submit a new form if still needed.
        </p>
      </div>
      <? } ?>

      <!-- Next Stage Info -->
      <div class="mt-4">
        <? if (nextStage && !['Final', 'Final (Rejected)', 'Completed', 'Error in Workflow'].includes(nextStage)) { ?>
        <p class="text-muted">The request has now moved to: <strong>
            <?= nextStage ?>
          </strong>.</p>
        <? } else if (nextStage === 'Error in Workflow') { ?>
        <p class="text-danger">An error occurred in the workflow. Please contact administration.</p>
        <? } else { ?>
        <p class="text-primary fw-bold">
          <? if (isAutoRejected) { ?>
          This request is now <strong>complete</strong> as an <em>Auto-Rejection</em>.
          <? } else { ?>
          This request process is now complete.
          <? } ?>
        </p>
        <? } ?>
      </div>

      <!-- Footer -->
      <div class="mt-4">
        <small class="text-muted">You can now close this window.</small>
      </div>
    </div>
  </div>
</body>

</html>